'use strict';

exports.__esModule = true;
exports.default = createStackFilter;

var _path = require('path');

var _lodash = require('lodash');

const BABEL = require.resolve('babel-core');
const BABEL_MODULES_DIR = BABEL.replace(new RegExp(`^(.*${(0, _lodash.escapeRegExp)(_path.sep)}node_modules${(0, _lodash.escapeRegExp)(_path.sep)})(.*)`), '$1');

const BABEL_RELATED = BABEL_MODULES_DIR + 'babel-';
const BABYLON = BABEL_MODULES_DIR + 'babylon' + _path.sep;
const CORE_JS = BABEL_MODULES_DIR + 'core-js' + _path.sep;
const REGENERATOR_RUNTIME = BABEL_MODULES_DIR + 'regenerator-runtime' + _path.sep;

const TESTCAFE_LIB = (0, _path.join)(__dirname, '../');
const TESTCAFE_BIN = (0, _path.join)(__dirname, '../../bin');
const TESTCAFE_HAMMERHEAD = `${_path.sep}testcafe-hammerhead${_path.sep}`;

const SOURCE_MAP_SUPPORT = `${_path.sep}source-map-support${_path.sep}`;

const INTERNAL = 'internal/';

function createStackFilter(limit) {
    let passedFramesCount = 0;

    return function stackFilter(frame) {
        if (passedFramesCount >= limit) return false;

        const filename = frame.getFileName();

        // NOTE: filter out the internals of node, Babel and TestCafe
        const pass = filename && filename.indexOf(_path.sep) > -1 && filename.indexOf(INTERNAL) !== 0 && filename.indexOf(TESTCAFE_LIB) !== 0 && filename.indexOf(TESTCAFE_BIN) !== 0 && filename.indexOf(TESTCAFE_HAMMERHEAD) < 0 && filename.indexOf(BABEL_RELATED) !== 0 && filename.indexOf(BABYLON) !== 0 && filename.indexOf(CORE_JS) !== 0 && filename.indexOf(REGENERATOR_RUNTIME) !== 0 && filename.indexOf(SOURCE_MAP_SUPPORT) < 0;

        if (pass) passedFramesCount++;

        return pass;
    };
}
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lcnJvcnMvY3JlYXRlLXN0YWNrLWZpbHRlci5qcyJdLCJuYW1lcyI6WyJjcmVhdGVTdGFja0ZpbHRlciIsIkJBQkVMIiwicmVxdWlyZSIsInJlc29sdmUiLCJCQUJFTF9NT0RVTEVTX0RJUiIsInJlcGxhY2UiLCJSZWdFeHAiLCJCQUJFTF9SRUxBVEVEIiwiQkFCWUxPTiIsIkNPUkVfSlMiLCJSRUdFTkVSQVRPUl9SVU5USU1FIiwiVEVTVENBRkVfTElCIiwiX19kaXJuYW1lIiwiVEVTVENBRkVfQklOIiwiVEVTVENBRkVfSEFNTUVSSEVBRCIsIlNPVVJDRV9NQVBfU1VQUE9SVCIsIklOVEVSTkFMIiwibGltaXQiLCJwYXNzZWRGcmFtZXNDb3VudCIsInN0YWNrRmlsdGVyIiwiZnJhbWUiLCJmaWxlbmFtZSIsImdldEZpbGVOYW1lIiwicGFzcyIsImluZGV4T2YiXSwibWFwcGluZ3MiOiI7OztrQkFtQndCQSxpQjs7QUFuQnhCOztBQUNBOztBQUVBLE1BQU1DLFFBQW9CQyxRQUFRQyxPQUFSLENBQWdCLFlBQWhCLENBQTFCO0FBQ0EsTUFBTUMsb0JBQW9CSCxNQUFNSSxPQUFOLENBQWMsSUFBSUMsTUFBSixDQUFZLE9BQU0sb0NBQWMsZUFBYyxvQ0FBYyxPQUE1RCxDQUFkLEVBQW1GLElBQW5GLENBQTFCOztBQUVBLE1BQU1DLGdCQUFzQkgsb0JBQW9CLFFBQWhEO0FBQ0EsTUFBTUksVUFBc0JKLG9CQUFvQixTQUFwQixZQUE1QjtBQUNBLE1BQU1LLFVBQXNCTCxvQkFBb0IsU0FBcEIsWUFBNUI7QUFDQSxNQUFNTSxzQkFBc0JOLG9CQUFvQixxQkFBcEIsWUFBNUI7O0FBRUEsTUFBTU8sZUFBc0IsZ0JBQUtDLFNBQUwsRUFBZ0IsS0FBaEIsQ0FBNUI7QUFDQSxNQUFNQyxlQUFzQixnQkFBS0QsU0FBTCxFQUFnQixXQUFoQixDQUE1QjtBQUNBLE1BQU1FLHNCQUF1QixHQUFELFNBQU8sc0JBQVAsU0FBZ0MsRUFBNUQ7O0FBRUEsTUFBTUMscUJBQXNCLEdBQUQsU0FBTyxxQkFBUCxTQUErQixFQUExRDs7QUFFQSxNQUFNQyxXQUFXLFdBQWpCOztBQUVlLFNBQVNoQixpQkFBVCxDQUE0QmlCLEtBQTVCLEVBQW1DO0FBQzlDLFFBQUlDLG9CQUFvQixDQUF4Qjs7QUFFQSxXQUFPLFNBQVNDLFdBQVQsQ0FBc0JDLEtBQXRCLEVBQTZCO0FBQ2hDLFlBQUlGLHFCQUFxQkQsS0FBekIsRUFDSSxPQUFPLEtBQVA7O0FBRUosY0FBTUksV0FBV0QsTUFBTUUsV0FBTixFQUFqQjs7QUFFQTtBQUNBLGNBQU1DLE9BQU9GLFlBQ0ZBLFNBQVNHLE9BQVQsY0FBd0IsQ0FBQyxDQUR2QixJQUVGSCxTQUFTRyxPQUFULENBQWlCUixRQUFqQixNQUErQixDQUY3QixJQUdGSyxTQUFTRyxPQUFULENBQWlCYixZQUFqQixNQUFtQyxDQUhqQyxJQUlGVSxTQUFTRyxPQUFULENBQWlCWCxZQUFqQixNQUFtQyxDQUpqQyxJQUtGUSxTQUFTRyxPQUFULENBQWlCVixtQkFBakIsSUFBd0MsQ0FMdEMsSUFNRk8sU0FBU0csT0FBVCxDQUFpQmpCLGFBQWpCLE1BQW9DLENBTmxDLElBT0ZjLFNBQVNHLE9BQVQsQ0FBaUJoQixPQUFqQixNQUE4QixDQVA1QixJQVFGYSxTQUFTRyxPQUFULENBQWlCZixPQUFqQixNQUE4QixDQVI1QixJQVNGWSxTQUFTRyxPQUFULENBQWlCZCxtQkFBakIsTUFBMEMsQ0FUeEMsSUFVRlcsU0FBU0csT0FBVCxDQUFpQlQsa0JBQWpCLElBQXVDLENBVmxEOztBQVlBLFlBQUlRLElBQUosRUFDSUw7O0FBRUosZUFBT0ssSUFBUDtBQUNILEtBdkJEO0FBd0JIIiwiZmlsZSI6ImVycm9ycy9jcmVhdGUtc3RhY2stZmlsdGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VwLCBqb2luIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBlc2NhcGVSZWdFeHAgYXMgZXNjYXBlUmUgfSBmcm9tICdsb2Rhc2gnO1xuXG5jb25zdCBCQUJFTCAgICAgICAgICAgICA9IHJlcXVpcmUucmVzb2x2ZSgnYmFiZWwtY29yZScpO1xuY29uc3QgQkFCRUxfTU9EVUxFU19ESVIgPSBCQUJFTC5yZXBsYWNlKG5ldyBSZWdFeHAoYF4oLioke2VzY2FwZVJlKHNlcCl9bm9kZV9tb2R1bGVzJHtlc2NhcGVSZShzZXApfSkoLiopYCksICckMScpO1xuXG5jb25zdCBCQUJFTF9SRUxBVEVEICAgICAgID0gQkFCRUxfTU9EVUxFU19ESVIgKyAnYmFiZWwtJztcbmNvbnN0IEJBQllMT04gICAgICAgICAgICAgPSBCQUJFTF9NT0RVTEVTX0RJUiArICdiYWJ5bG9uJyArIHNlcDtcbmNvbnN0IENPUkVfSlMgICAgICAgICAgICAgPSBCQUJFTF9NT0RVTEVTX0RJUiArICdjb3JlLWpzJyArIHNlcDtcbmNvbnN0IFJFR0VORVJBVE9SX1JVTlRJTUUgPSBCQUJFTF9NT0RVTEVTX0RJUiArICdyZWdlbmVyYXRvci1ydW50aW1lJyArIHNlcDtcblxuY29uc3QgVEVTVENBRkVfTElCICAgICAgICA9IGpvaW4oX19kaXJuYW1lLCAnLi4vJyk7XG5jb25zdCBURVNUQ0FGRV9CSU4gICAgICAgID0gam9pbihfX2Rpcm5hbWUsICcuLi8uLi9iaW4nKTtcbmNvbnN0IFRFU1RDQUZFX0hBTU1FUkhFQUQgPSBgJHtzZXB9dGVzdGNhZmUtaGFtbWVyaGVhZCR7c2VwfWA7XG5cbmNvbnN0IFNPVVJDRV9NQVBfU1VQUE9SVCA9IGAke3NlcH1zb3VyY2UtbWFwLXN1cHBvcnQke3NlcH1gO1xuXG5jb25zdCBJTlRFUk5BTCA9ICdpbnRlcm5hbC8nO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVTdGFja0ZpbHRlciAobGltaXQpIHtcbiAgICBsZXQgcGFzc2VkRnJhbWVzQ291bnQgPSAwO1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uIHN0YWNrRmlsdGVyIChmcmFtZSkge1xuICAgICAgICBpZiAocGFzc2VkRnJhbWVzQ291bnQgPj0gbGltaXQpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBmcmFtZS5nZXRGaWxlTmFtZSgpO1xuXG4gICAgICAgIC8vIE5PVEU6IGZpbHRlciBvdXQgdGhlIGludGVybmFscyBvZiBub2RlLCBCYWJlbCBhbmQgVGVzdENhZmVcbiAgICAgICAgY29uc3QgcGFzcyA9IGZpbGVuYW1lICYmXG4gICAgICAgICAgICAgICAgICAgZmlsZW5hbWUuaW5kZXhPZihzZXApID4gLTEgJiZcbiAgICAgICAgICAgICAgICAgICBmaWxlbmFtZS5pbmRleE9mKElOVEVSTkFMKSAhPT0gMCAmJlxuICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lLmluZGV4T2YoVEVTVENBRkVfTElCKSAhPT0gMCAmJlxuICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lLmluZGV4T2YoVEVTVENBRkVfQklOKSAhPT0gMCAmJlxuICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lLmluZGV4T2YoVEVTVENBRkVfSEFNTUVSSEVBRCkgPCAwICYmXG4gICAgICAgICAgICAgICAgICAgZmlsZW5hbWUuaW5kZXhPZihCQUJFTF9SRUxBVEVEKSAhPT0gMCAmJlxuICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lLmluZGV4T2YoQkFCWUxPTikgIT09IDAgJiZcbiAgICAgICAgICAgICAgICAgICBmaWxlbmFtZS5pbmRleE9mKENPUkVfSlMpICE9PSAwICYmXG4gICAgICAgICAgICAgICAgICAgZmlsZW5hbWUuaW5kZXhPZihSRUdFTkVSQVRPUl9SVU5USU1FKSAhPT0gMCAmJlxuICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lLmluZGV4T2YoU09VUkNFX01BUF9TVVBQT1JUKSA8IDA7XG5cbiAgICAgICAgaWYgKHBhc3MpXG4gICAgICAgICAgICBwYXNzZWRGcmFtZXNDb3VudCsrO1xuXG4gICAgICAgIHJldHVybiBwYXNzO1xuICAgIH07XG59XG4iXX0=
