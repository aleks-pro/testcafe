'use strict';

exports.__esModule = true;
exports.getTestListFromCode = exports.getTestList = exports.EsNextTestFileParser = undefined;

var _lodash = require('lodash');

var _babelCore = require('babel-core');

var _compiler = require('./compiler');

var _compiler2 = _interopRequireDefault(_compiler);

var _testFileParserBase = require('../../test-file-parser-base');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const TOKEN_TYPE = {
    Identifier: 'Identifier',
    PropertyAccessExpression: 'MemberExpression',
    CallExpression: 'CallExpression',
    TaggedTemplateExpression: 'TaggedTemplateExpression',
    TemplateLiteral: 'TemplateLiteral',
    StringLiteral: 'StringLiteral',
    ArrowFunctionExpression: 'ArrowFunctionExpression',
    FunctionExpression: 'FunctionExpression',
    ExpressionStatement: 'ExpressionStatement',
    ReturnStatement: 'ReturnStatement',
    FunctionDeclaration: 'FunctionDeclaration',
    VariableStatement: 'VariableStatement',
    VariableDeclaration: 'VariableDeclaration',
    ObjectLiteralExpression: 'ObjectExpression'
};

class EsNextTestFileParser extends _testFileParserBase.TestFileParserBase {
    constructor() {
        super(TOKEN_TYPE);
    }

    static getTagStrValue(exp) {
        //NOTE: we set <computed name> if template literal has at least one computed substring ${...}
        return exp.expressions.length ? EsNextTestFileParser.formatComputedName(exp.loc.start.line) : exp.quasis[0].value.raw;
    }

    isAsyncFn(token) {
        return token.async || token.generator;
    }

    getTokenType(token) {
        return token.type;
    }

    getRValue(token) {
        return token.declarations[0].init;
    }

    getStringValue(token) {
        const stringTypes = [this.tokenType.StringLiteral, this.tokenType.TemplateLiteral, this.tokenType.Identifier];

        if (stringTypes.indexOf(token.type) > -1) return this.formatFnArg(token);

        return null;
    }

    getFunctionBody(token) {
        return token.body && token.body.body ? token.body.body : [];
    }

    getCalleeToken(token) {
        return token.callee;
    }

    getMemberFnName(token) {
        return token.callee.property.name;
    }

    formatFnData(name, value, token, meta = [{}]) {
        return {
            fnName: name,
            value: value,
            loc: token.loc,
            start: token.start,
            end: token.end,
            meta: (0, _lodash.merge)({}, ...meta)
        };
    }

    getKeyValue(prop) {
        const key = prop.key,
              value = prop.value;


        return {
            key: key.name || this.formatFnArg(key),
            value: this.getStringValue(value)
        };
    }

    analyzeMemberExp(token) {
        let exp = token;
        const tokenType = this.tokenType;
        const callStack = [exp];

        while (exp.type !== tokenType.Identifier) {
            if (exp.type === tokenType.CallExpression) exp = exp.callee;else if (exp.type === tokenType.PropertyAccessExpression) exp = exp.object;else if (exp.type === tokenType.TaggedTemplateExpression) exp = exp.tag;else return null;

            if (exp.type !== tokenType.Identifier) callStack.push(exp);
        }

        if (!this.isApiFn(exp.name)) return null;

        const meta = this.getMetaInfo(callStack.slice());

        let parentExp = callStack.pop();

        if (parentExp.type === tokenType.CallExpression) return this.formatFnData(exp.name, this.formatFnArg(parentExp.arguments[0]), token, meta);

        if (parentExp.type === tokenType.TaggedTemplateExpression) return this.formatFnData(exp.name, EsNextTestFileParser.getTagStrValue(parentExp.quasi), token, meta);

        if (parentExp.type === tokenType.PropertyAccessExpression) {
            while (parentExp) {
                if (parentExp.type === tokenType.CallExpression && parentExp.callee) {
                    const calleeType = parentExp.callee.type;
                    const calleeMemberFn = parentExp.callee.property && parentExp.callee.property.name;

                    if (this.checkExpDefineTargetName(calleeType, calleeMemberFn)) return this.formatFnData(exp.name, this.formatFnArg(parentExp.arguments[0]), token, meta);
                }

                if (parentExp.type === tokenType.TaggedTemplateExpression && parentExp.tag) {
                    const tagType = parentExp.tag.type;
                    const tagMemberFn = parentExp.tag.property && parentExp.tag.property.name;

                    if (this.checkExpDefineTargetName(tagType, tagMemberFn)) return this.formatFnData(exp.name, EsNextTestFileParser.getTagStrValue(parentExp.quasi), token, meta);
                }

                parentExp = callStack.pop();
            }
        }

        return null;
    }

    formatFnArg(arg) {
        if (arg.type === this.tokenType.Identifier) return EsNextTestFileParser.formatComputedName(arg.loc.start.line);

        if (arg.type === this.tokenType.TemplateLiteral) return EsNextTestFileParser.getTagStrValue(arg);

        if (arg.type === this.tokenType.StringLiteral) return arg.value;

        return null;
    }

    getFnCall(token) {
        if (!this.isApiFn(token.callee.name)) return null;

        return this.formatFnData(token.callee.name, this.formatFnArg(token.arguments[0]), token);
    }

    getTaggedTemplateExp(token) {
        return this.formatFnData(token.tag.name, EsNextTestFileParser.getTagStrValue(token.quasi), token);
    }

    analyzeFnCall(token) {
        const tokenType = this.tokenType;

        if (token.type === tokenType.PropertyAccessExpression) return this.analyzeMemberExp(token);

        if (token.type === tokenType.CallExpression) {
            const calleeType = token.callee.type;

            if (calleeType === tokenType.PropertyAccessExpression || calleeType === tokenType.CallExpression) return this.analyzeMemberExp(token);

            if (calleeType === tokenType.FunctionExpression || calleeType === tokenType.ArrowFunctionExpression) return this.collectTestCafeCalls(token.callee.body.body);

            return this.getFnCall(token);
        }

        if (token.type === tokenType.TaggedTemplateExpression) {
            if (token.tag.type === tokenType.PropertyAccessExpression) return this.analyzeMemberExp(token);

            return this.getTaggedTemplateExp(token);
        }

        return null;
    }

    parse(code) {
        const compilerOptions = _compiler2.default.getBabelOptions(null, code);

        delete compilerOptions.filename;

        const opts = (0, _lodash.assign)(compilerOptions, { ast: true });
        const ast = (0, _babelCore.transform)(code, opts).ast;

        return this.analyze(ast.program.body);
    }
}

exports.EsNextTestFileParser = EsNextTestFileParser;
const parser = new EsNextTestFileParser();

const getTestList = exports.getTestList = parser.getTestList.bind(parser);
const getTestListFromCode = exports.getTestListFromCode = parser.getTestListFromCode.bind(parser);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9jb21waWxlci90ZXN0LWZpbGUvZm9ybWF0cy9lcy1uZXh0L2dldC10ZXN0LWxpc3QuanMiXSwibmFtZXMiOlsiVE9LRU5fVFlQRSIsIklkZW50aWZpZXIiLCJQcm9wZXJ0eUFjY2Vzc0V4cHJlc3Npb24iLCJDYWxsRXhwcmVzc2lvbiIsIlRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbiIsIlRlbXBsYXRlTGl0ZXJhbCIsIlN0cmluZ0xpdGVyYWwiLCJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiIsIkZ1bmN0aW9uRXhwcmVzc2lvbiIsIkV4cHJlc3Npb25TdGF0ZW1lbnQiLCJSZXR1cm5TdGF0ZW1lbnQiLCJGdW5jdGlvbkRlY2xhcmF0aW9uIiwiVmFyaWFibGVTdGF0ZW1lbnQiLCJWYXJpYWJsZURlY2xhcmF0aW9uIiwiT2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24iLCJFc05leHRUZXN0RmlsZVBhcnNlciIsImNvbnN0cnVjdG9yIiwiZ2V0VGFnU3RyVmFsdWUiLCJleHAiLCJleHByZXNzaW9ucyIsImxlbmd0aCIsImZvcm1hdENvbXB1dGVkTmFtZSIsImxvYyIsInN0YXJ0IiwibGluZSIsInF1YXNpcyIsInZhbHVlIiwicmF3IiwiaXNBc3luY0ZuIiwidG9rZW4iLCJhc3luYyIsImdlbmVyYXRvciIsImdldFRva2VuVHlwZSIsInR5cGUiLCJnZXRSVmFsdWUiLCJkZWNsYXJhdGlvbnMiLCJpbml0IiwiZ2V0U3RyaW5nVmFsdWUiLCJzdHJpbmdUeXBlcyIsInRva2VuVHlwZSIsImluZGV4T2YiLCJmb3JtYXRGbkFyZyIsImdldEZ1bmN0aW9uQm9keSIsImJvZHkiLCJnZXRDYWxsZWVUb2tlbiIsImNhbGxlZSIsImdldE1lbWJlckZuTmFtZSIsInByb3BlcnR5IiwibmFtZSIsImZvcm1hdEZuRGF0YSIsIm1ldGEiLCJmbk5hbWUiLCJlbmQiLCJnZXRLZXlWYWx1ZSIsInByb3AiLCJrZXkiLCJhbmFseXplTWVtYmVyRXhwIiwiY2FsbFN0YWNrIiwib2JqZWN0IiwidGFnIiwicHVzaCIsImlzQXBpRm4iLCJnZXRNZXRhSW5mbyIsInNsaWNlIiwicGFyZW50RXhwIiwicG9wIiwiYXJndW1lbnRzIiwicXVhc2kiLCJjYWxsZWVUeXBlIiwiY2FsbGVlTWVtYmVyRm4iLCJjaGVja0V4cERlZmluZVRhcmdldE5hbWUiLCJ0YWdUeXBlIiwidGFnTWVtYmVyRm4iLCJhcmciLCJnZXRGbkNhbGwiLCJnZXRUYWdnZWRUZW1wbGF0ZUV4cCIsImFuYWx5emVGbkNhbGwiLCJjb2xsZWN0VGVzdENhZmVDYWxscyIsInBhcnNlIiwiY29kZSIsImNvbXBpbGVyT3B0aW9ucyIsImdldEJhYmVsT3B0aW9ucyIsImZpbGVuYW1lIiwib3B0cyIsImFzdCIsImFuYWx5emUiLCJwcm9ncmFtIiwicGFyc2VyIiwiZ2V0VGVzdExpc3QiLCJiaW5kIiwiZ2V0VGVzdExpc3RGcm9tQ29kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7OztBQUNBOzs7O0FBRUEsTUFBTUEsYUFBYTtBQUNmQyxnQkFBMEIsWUFEWDtBQUVmQyw4QkFBMEIsa0JBRlg7QUFHZkMsb0JBQTBCLGdCQUhYO0FBSWZDLDhCQUEwQiwwQkFKWDtBQUtmQyxxQkFBMEIsaUJBTFg7QUFNZkMsbUJBQTBCLGVBTlg7QUFPZkMsNkJBQTBCLHlCQVBYO0FBUWZDLHdCQUEwQixvQkFSWDtBQVNmQyx5QkFBMEIscUJBVFg7QUFVZkMscUJBQTBCLGlCQVZYO0FBV2ZDLHlCQUEwQixxQkFYWDtBQVlmQyx1QkFBMEIsbUJBWlg7QUFhZkMseUJBQTBCLHFCQWJYO0FBY2ZDLDZCQUEwQjtBQWRYLENBQW5COztBQWlCTyxNQUFNQyxvQkFBTixnREFBc0Q7QUFDekRDLGtCQUFlO0FBQ1gsY0FBTWhCLFVBQU47QUFDSDs7QUFFRCxXQUFPaUIsY0FBUCxDQUF1QkMsR0FBdkIsRUFBNEI7QUFDeEI7QUFDQSxlQUFPQSxJQUFJQyxXQUFKLENBQWdCQyxNQUFoQixHQUF5QkwscUJBQXFCTSxrQkFBckIs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RCxZQUFJQSxNQUFNSSxJQUFOLEtBQWVNLFVBQVVuQyx3QkFBN0IsRUFBdUQ7QUFDbkQsZ0JBQUl5QixNQUFNOEIsR0FBTixDQUFVMUIsSUFBVixLQUFtQk0sVUFBVXJDLHdCQUFqQyxFQUNJLE9BQU8sS0FBS3NELGdCQUFMLENBQXNCM0IsS0FBdEIsQ0FBUDs7QUFFSixtQkFBTyxLQUFLOEMsb0JBQUwsQ0FBMEI5QyxLQUExQixDQUFQO0FBQ0g7O0FBRUQsZUFBTyxJQUFQO0FBQ0g7O0FBRURpRCxVQUFPQyxJQUFQLEVBQWE7QUFDVCxjQUFNQyxrQkFBa0IsbUJBQXVCQyxlQUF2QixDQUF1QyxJQUF2QyxFQUE2Q0YsSUFBN0MsQ0FBeEI7O0FBRUEsZUFBT0MsZ0JBQWdCRSxRQUF2Qjs7QUFFQSxjQUFNQyxPQUFPLG9CQUFPSCxlQUFQLEVBQXdCLEVBQUVJLEtBQUssSUFBUCxFQUF4QixDQUFiO0FBQ0EsY0FBTUEsTUFBTywwQkFBVUwsSUFBVixFQUFnQkksSUFBaEIsRUFBc0JDLEdBQW5DOztBQUVBLGVBQU8sS0FBS0MsT0FBTCxDQUFhRCxJQUFJRSxPQUFKLENBQVkzQyxJQUF6QixDQUFQO0FBQ0g7QUF0THdEOztRQUFoRDVCLG9CLEdBQUFBLG9CO0FBeUxiLE1BQU13RSxTQUFTLElBQUl4RSxvQkFBSixFQUFmOztBQUVPLE1BQU15RSxvQ0FBc0JELE9BQU9DLFdBQVAsQ0FBbUJDLElBQW5CLENBQXdCRixNQUF4QixDQUE1QjtBQUNBLE1BQU1HLG9EQUFzQkgsT0FBT0csbUJBQVAsQ0FBMkJELElBQTNCLENBQWdDRixNQUFoQyxDQUE1QiIsImZpbGUiOiJjb21waWxlci90ZXN0LWZpbGUvZm9ybWF0cy9lcy1uZXh0L2dldC10ZXN0LWxpc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhc3NpZ24sIG1lcmdlIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHRyYW5zZm9ybSB9IGZyb20gJ2JhYmVsLWNvcmUnO1xuaW1wb3J0IEVTTmV4dFRlc3RGaWxlQ29tcGlsZXIgZnJvbSAnLi9jb21waWxlcic7XG5pbXBvcnQgeyBUZXN0RmlsZVBhcnNlckJhc2UgfSBmcm9tICcuLi8uLi90ZXN0LWZpbGUtcGFyc2VyLWJhc2UnO1xuXG5jb25zdCBUT0tFTl9UWVBFID0ge1xuICAgIElkZW50aWZpZXI6ICAgICAgICAgICAgICAgJ0lkZW50aWZpZXInLFxuICAgIFByb3BlcnR5QWNjZXNzRXhwcmVzc2lvbjogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgIENhbGxFeHByZXNzaW9uOiAgICAgICAgICAgJ0NhbGxFeHByZXNzaW9uJyxcbiAgICBUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb246ICdUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24nLFxuICAgIFRlbXBsYXRlTGl0ZXJhbDogICAgICAgICAgJ1RlbXBsYXRlTGl0ZXJhbCcsXG4gICAgU3RyaW5nTGl0ZXJhbDogICAgICAgICAgICAnU3RyaW5nTGl0ZXJhbCcsXG4gICAgQXJyb3dGdW5jdGlvbkV4cHJlc3Npb246ICAnQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24nLFxuICAgIEZ1bmN0aW9uRXhwcmVzc2lvbjogICAgICAgJ0Z1bmN0aW9uRXhwcmVzc2lvbicsXG4gICAgRXhwcmVzc2lvblN0YXRlbWVudDogICAgICAnRXhwcmVzc2lvblN0YXRlbWVudCcsXG4gICAgUmV0dXJuU3RhdGVtZW50OiAgICAgICAgICAnUmV0dXJuU3RhdGVtZW50JyxcbiAgICBGdW5jdGlvbkRlY2xhcmF0aW9uOiAgICAgICdGdW5jdGlvbkRlY2xhcmF0aW9uJyxcbiAgICBWYXJpYWJsZVN0YXRlbWVudDogICAgICAgICdWYXJpYWJsZVN0YXRlbWVudCcsXG4gICAgVmFyaWFibGVEZWNsYXJhdGlvbjogICAgICAnVmFyaWFibGVEZWNsYXJhdGlvbicsXG4gICAgT2JqZWN0TGl0ZXJhbEV4cHJlc3Npb246ICAnT2JqZWN0RXhwcmVzc2lvbidcbn07XG5cbmV4cG9ydCBjbGFzcyBFc05leHRUZXN0RmlsZVBhcnNlciBleHRlbmRzIFRlc3RGaWxlUGFyc2VyQmFzZSB7XG4gICAgY29uc3RydWN0b3IgKCkge1xuICAgICAgICBzdXBlcihUT0tFTl9UWVBFKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0VGFnU3RyVmFsdWUgKGV4cCkge1xuICAgICAgICAvL05PVEU6IHdlIHNldCA8Y29tcHV0ZWQgbmFtZT4gaWYgdGVtcGxhdGUgbGl0ZXJhbCBoYXMgYXQgbGVhc3Qgb25lIGNvbXB1dGVkIHN1YnN0cmluZyAkey4uLn1cbiAgICAgICAgcmV0dXJuIGV4cC5leHByZXNzaW9ucy5sZW5ndGggPyBFc05leHRUZXN0RmlsZVBhcnNlci5mb3JtYXRDb21wdXRlZE5hbWUoZXhwLmxvYy5zdGFydC5saW5lKSA6IGV4cC5xdWFzaXNbMF0udmFsdWUucmF3O1xuICAgIH1cblxuICAgIGlzQXN5bmNGbiAodG9rZW4pIHtcbiAgICAgICAgcmV0dXJuIHRva2VuLmFzeW5jIHx8IHRva2VuLmdlbmVyYXRvcjtcbiAgICB9XG5cbiAgICBnZXRUb2tlblR5cGUgKHRva2VuKSB7XG4gICAgICAgIHJldHVybiB0b2tlbi50eXBlO1xuICAgIH1cblxuICAgIGdldFJWYWx1ZSAodG9rZW4pIHtcbiAgICAgICAgcmV0dXJuIHRva2VuLmRlY2xhcmF0aW9uc1swXS5pbml0O1xuICAgIH1cblxuICAgIGdldFN0cmluZ1ZhbHVlICh0b2tlbikge1xuICAgICAgICBjb25zdCBzdHJpbmdUeXBlcyA9IFt0aGlzLnRva2VuVHlwZS5TdHJpbmdMaXRlcmFsLCB0aGlzLnRva2VuVHlwZS5UZW1wbGF0ZUxpdGVyYWwsIHRoaXMudG9rZW5UeXBlLklkZW50aWZpZXJdO1xuXG4gICAgICAgIGlmIChzdHJpbmdUeXBlcy5pbmRleE9mKHRva2VuLnR5cGUpID4gLTEpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRGbkFyZyh0b2tlbik7XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgZ2V0RnVuY3Rpb25Cb2R5ICh0b2tlbikge1xuICAgICAgICByZXR1cm4gdG9rZW4uYm9keSAmJiB0b2tlbi5ib2R5LmJvZHkgPyB0b2tlbi5ib2R5LmJvZHkgOiBbXTtcbiAgICB9XG5cbiAgICBnZXRDYWxsZWVUb2tlbiAodG9rZW4pIHtcbiAgICAgICAgcmV0dXJuIHRva2VuLmNhbGxlZTtcbiAgICB9XG5cbiAgICBnZXRNZW1iZXJGbk5hbWUgKHRva2VuKSB7XG4gICAgICAgIHJldHVybiB0b2tlbi5jYWxsZWUucHJvcGVydHkubmFtZTtcbiAgICB9XG5cbiAgICBmb3JtYXRGbkRhdGEgKG5hbWUsIHZhbHVlLCB0b2tlbiwgbWV0YSA9IFt7fV0pIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZuTmFtZTogbmFtZSxcbiAgICAgICAgICAgIHZhbHVlOiAgdmFsdWUsXG4gICAgICAgICAgICBsb2M6ICAgIHRva2VuLmxvYyxcbiAgICAgICAgICAgIHN0YXJ0OiAgdG9rZW4uc3RhcnQsXG4gICAgICAgICAgICBlbmQ6ICAgIHRva2VuLmVuZCxcbiAgICAgICAgICAgIG1ldGE6ICAgbWVyZ2Uoe30sIC4uLm1ldGEpXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZ2V0S2V5VmFsdWUgKHByb3ApIHtcbiAgICAgICAgY29uc3QgeyBrZXksIHZhbHVlIH0gPSBwcm9wO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBrZXk6ICAga2V5Lm5hbWUgfHwgdGhpcy5mb3JtYXRGbkFyZyhrZXkpLFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ2V0U3RyaW5nVmFsdWUodmFsdWUpXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgYW5hbHl6ZU1lbWJlckV4cCAodG9rZW4pIHtcbiAgICAgICAgbGV0IGV4cCAgICAgICAgID0gdG9rZW47XG4gICAgICAgIGNvbnN0IHRva2VuVHlwZSA9IHRoaXMudG9rZW5UeXBlO1xuICAgICAgICBjb25zdCBjYWxsU3RhY2sgPSBbZXhwXTtcblxuICAgICAgICB3aGlsZSAoZXhwLnR5cGUgIT09IHRva2VuVHlwZS5JZGVudGlmaWVyKSB7XG4gICAgICAgICAgICBpZiAoZXhwLnR5cGUgPT09IHRva2VuVHlwZS5DYWxsRXhwcmVzc2lvbilcbiAgICAgICAgICAgICAgICBleHAgPSBleHAuY2FsbGVlO1xuXG4gICAgICAgICAgICBlbHNlIGlmIChleHAudHlwZSA9PT0gdG9rZW5UeXBlLlByb3BlcnR5QWNjZXNzRXhwcmVzc2lvbilcbiAgICAgICAgICAgICAgICBleHAgPSBleHAub2JqZWN0O1xuXG4gICAgICAgICAgICBlbHNlIGlmIChleHAudHlwZSA9PT0gdG9rZW5UeXBlLlRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbilcbiAgICAgICAgICAgICAgICBleHAgPSBleHAudGFnO1xuXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgICAgIGlmIChleHAudHlwZSAhPT0gdG9rZW5UeXBlLklkZW50aWZpZXIpXG4gICAgICAgICAgICAgICAgY2FsbFN0YWNrLnB1c2goZXhwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5pc0FwaUZuKGV4cC5uYW1lKSkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgY29uc3QgbWV0YSA9IHRoaXMuZ2V0TWV0YUluZm8oY2FsbFN0YWNrLnNsaWNlKCkpO1xuXG4gICAgICAgIGxldCBwYXJlbnRFeHAgPSBjYWxsU3RhY2sucG9wKCk7XG5cbiAgICAgICAgaWYgKHBhcmVudEV4cC50eXBlID09PSB0b2tlblR5cGUuQ2FsbEV4cHJlc3Npb24pXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRGbkRhdGEoZXhwLm5hbWUsIHRoaXMuZm9ybWF0Rm5BcmcocGFyZW50RXhwLmFyZ3VtZW50c1swXSksIHRva2VuLCBtZXRhKTtcblxuICAgICAgICBpZiAocGFyZW50RXhwLnR5cGUgPT09IHRva2VuVHlwZS5UYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24pXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRGbkRhdGEoZXhwLm5hbWUsIEVzTmV4dFRlc3RGaWxlUGFyc2VyLmdldFRhZ1N0clZhbHVlKHBhcmVudEV4cC5xdWFzaSksIHRva2VuLCBtZXRhKTtcblxuICAgICAgICBpZiAocGFyZW50RXhwLnR5cGUgPT09IHRva2VuVHlwZS5Qcm9wZXJ0eUFjY2Vzc0V4cHJlc3Npb24pIHtcbiAgICAgICAgICAgIHdoaWxlIChwYXJlbnRFeHApIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50RXhwLnR5cGUgPT09IHRva2VuVHlwZS5DYWxsRXhwcmVzc2lvbiAmJiBwYXJlbnRFeHAuY2FsbGVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxlZVR5cGUgICAgID0gcGFyZW50RXhwLmNhbGxlZS50eXBlO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWxsZWVNZW1iZXJGbiA9IHBhcmVudEV4cC5jYWxsZWUucHJvcGVydHkgJiYgcGFyZW50RXhwLmNhbGxlZS5wcm9wZXJ0eS5uYW1lO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrRXhwRGVmaW5lVGFyZ2V0TmFtZShjYWxsZWVUeXBlLCBjYWxsZWVNZW1iZXJGbikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRGbkRhdGEoZXhwLm5hbWUsIHRoaXMuZm9ybWF0Rm5BcmcocGFyZW50RXhwLmFyZ3VtZW50c1swXSksIHRva2VuLCBtZXRhKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocGFyZW50RXhwLnR5cGUgPT09IHRva2VuVHlwZS5UYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24gJiYgcGFyZW50RXhwLnRhZykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWdUeXBlICAgICA9IHBhcmVudEV4cC50YWcudHlwZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFnTWVtYmVyRm4gPSBwYXJlbnRFeHAudGFnLnByb3BlcnR5ICYmIHBhcmVudEV4cC50YWcucHJvcGVydHkubmFtZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja0V4cERlZmluZVRhcmdldE5hbWUodGFnVHlwZSwgdGFnTWVtYmVyRm4pKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0Rm5EYXRhKGV4cC5uYW1lLCBFc05leHRUZXN0RmlsZVBhcnNlci5nZXRUYWdTdHJWYWx1ZShwYXJlbnRFeHAucXVhc2kpLCB0b2tlbiwgbWV0YSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcGFyZW50RXhwID0gY2FsbFN0YWNrLnBvcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgZm9ybWF0Rm5BcmcgKGFyZykge1xuICAgICAgICBpZiAoYXJnLnR5cGUgPT09IHRoaXMudG9rZW5UeXBlLklkZW50aWZpZXIpXG4gICAgICAgICAgICByZXR1cm4gRXNOZXh0VGVzdEZpbGVQYXJzZXIuZm9ybWF0Q29tcHV0ZWROYW1lKGFyZy5sb2Muc3RhcnQubGluZSk7XG5cbiAgICAgICAgaWYgKGFyZy50eXBlID09PSB0aGlzLnRva2VuVHlwZS5UZW1wbGF0ZUxpdGVyYWwpXG4gICAgICAgICAgICByZXR1cm4gRXNOZXh0VGVzdEZpbGVQYXJzZXIuZ2V0VGFnU3RyVmFsdWUoYXJnKTtcblxuICAgICAgICBpZiAoYXJnLnR5cGUgPT09IHRoaXMudG9rZW5UeXBlLlN0cmluZ0xpdGVyYWwpXG4gICAgICAgICAgICByZXR1cm4gYXJnLnZhbHVlO1xuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGdldEZuQ2FsbCAodG9rZW4pIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQXBpRm4odG9rZW4uY2FsbGVlLm5hbWUpKSByZXR1cm4gbnVsbDtcblxuICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRGbkRhdGEodG9rZW4uY2FsbGVlLm5hbWUsIHRoaXMuZm9ybWF0Rm5BcmcodG9rZW4uYXJndW1lbnRzWzBdKSwgdG9rZW4pO1xuICAgIH1cblxuICAgIGdldFRhZ2dlZFRlbXBsYXRlRXhwICh0b2tlbikge1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRGbkRhdGEodG9rZW4udGFnLm5hbWUsIEVzTmV4dFRlc3RGaWxlUGFyc2VyLmdldFRhZ1N0clZhbHVlKHRva2VuLnF1YXNpKSwgdG9rZW4pO1xuICAgIH1cblxuICAgIGFuYWx5emVGbkNhbGwgKHRva2VuKSB7XG4gICAgICAgIGNvbnN0IHRva2VuVHlwZSA9IHRoaXMudG9rZW5UeXBlO1xuXG4gICAgICAgIGlmICh0b2tlbi50eXBlID09PSB0b2tlblR5cGUuUHJvcGVydHlBY2Nlc3NFeHByZXNzaW9uKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5hbHl6ZU1lbWJlckV4cCh0b2tlbik7XG5cbiAgICAgICAgaWYgKHRva2VuLnR5cGUgPT09IHRva2VuVHlwZS5DYWxsRXhwcmVzc2lvbikge1xuICAgICAgICAgICAgY29uc3QgY2FsbGVlVHlwZSA9IHRva2VuLmNhbGxlZS50eXBlO1xuXG4gICAgICAgICAgICBpZiAoY2FsbGVlVHlwZSA9PT0gdG9rZW5UeXBlLlByb3BlcnR5QWNjZXNzRXhwcmVzc2lvbiB8fCBjYWxsZWVUeXBlID09PSB0b2tlblR5cGUuQ2FsbEV4cHJlc3Npb24pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5hbHl6ZU1lbWJlckV4cCh0b2tlbik7XG5cbiAgICAgICAgICAgIGlmIChjYWxsZWVUeXBlID09PSB0b2tlblR5cGUuRnVuY3Rpb25FeHByZXNzaW9uIHx8IGNhbGxlZVR5cGUgPT09IHRva2VuVHlwZS5BcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbilcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb2xsZWN0VGVzdENhZmVDYWxscyh0b2tlbi5jYWxsZWUuYm9keS5ib2R5KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Rm5DYWxsKHRva2VuKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0b2tlbi50eXBlID09PSB0b2tlblR5cGUuVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uKSB7XG4gICAgICAgICAgICBpZiAodG9rZW4udGFnLnR5cGUgPT09IHRva2VuVHlwZS5Qcm9wZXJ0eUFjY2Vzc0V4cHJlc3Npb24pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5hbHl6ZU1lbWJlckV4cCh0b2tlbik7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRhZ2dlZFRlbXBsYXRlRXhwKHRva2VuKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHBhcnNlIChjb2RlKSB7XG4gICAgICAgIGNvbnN0IGNvbXBpbGVyT3B0aW9ucyA9IEVTTmV4dFRlc3RGaWxlQ29tcGlsZXIuZ2V0QmFiZWxPcHRpb25zKG51bGwsIGNvZGUpO1xuXG4gICAgICAgIGRlbGV0ZSBjb21waWxlck9wdGlvbnMuZmlsZW5hbWU7XG5cbiAgICAgICAgY29uc3Qgb3B0cyA9IGFzc2lnbihjb21waWxlck9wdGlvbnMsIHsgYXN0OiB0cnVlIH0pO1xuICAgICAgICBjb25zdCBhc3QgID0gdHJhbnNmb3JtKGNvZGUsIG9wdHMpLmFzdDtcblxuICAgICAgICByZXR1cm4gdGhpcy5hbmFseXplKGFzdC5wcm9ncmFtLmJvZHkpO1xuICAgIH1cbn1cblxuY29uc3QgcGFyc2VyID0gbmV3IEVzTmV4dFRlc3RGaWxlUGFyc2VyKCk7XG5cbmV4cG9ydCBjb25zdCBnZXRUZXN0TGlzdCAgICAgICAgID0gcGFyc2VyLmdldFRlc3RMaXN0LmJpbmQocGFyc2VyKTtcbmV4cG9ydCBjb25zdCBnZXRUZXN0TGlzdEZyb21Db2RlID0gcGFyc2VyLmdldFRlc3RMaXN0RnJvbUNvZGUuYmluZChwYXJzZXIpO1xuIl19
